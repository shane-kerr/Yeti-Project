# Yeti Mutli-ZSK 测试方案

## 背景和目标
Yeti平台采用Multi-DM 的设置，让每个DM有自己的独立管理域和权限，包括根区生成，密钥管理和签名机制；
Multi-ZSK的方案是其中关键一环。测试的目的是为了验证现有DNS协议和软件机制是否能够通过合理的配置完成
Multi-ZSK的功能，并且找到解决方案。

## 测试方案

### 测试场景设置

如图1所示，一个resolver，两个root server(可以看做是两个DM)，如图所示连接. 

DNS服务器的设置如下：
 * 有相同的名字空间，包括顶端NS记录
 
 * 有共同的KSK， 但是分别采用不同的ZSK签名（ZSK A和ZSK B）
 
 	* ZSK 的参数可以相同也可以不同，比如有效时间
 	
 * Resolver 配置Hint文件中只包含这两个根服务器
 
 * Resolver 支持key rollover

```
+---------------+          +---------------+  
|    Root A     |          |     Root B    |  
|               |          |               |  
+-------+-------+          +--------+------+  
        |                           |        
--------+------------+--------------+--------                       
                       |                        
             +---------+----------+             
             |                    |                      
             |     Resolver       |                        
             +--------------------+             
```
### 测试流程

 * Step1: 在Time 1时间段，关掉Root B， 让Resolver 先从Root A 进行初始化priming，进行某一个签名TLD的查询，
 需要DNSSEC验证（获取KSK和ZSK公钥）
 
 * Step2: 在Time 2时间段，关掉Root A, 让Resolver 切换到Root B进行同样的查询
 
 * Step3: 比较第一次和第二次查询结果，如果查询结果相同表示测试通过，如果结果不同，输出相应的log或者debug结果
 
 * Step4: 在ZSK轮转期间重复step1-3，比较ZSK轮转期间与之前的测试结果

### 不同的测试场景

 * Case 1: 第一Root A和Root B按照默认配置，只携带自己的ZSK，按照测试流程step1-3 观察可鞥出错的情况
 
 * Case 2: 让Root A和Root B 同时携带两个ZSK A和ZSK B（参数相同），重复测试流程step1-3，观察
 resolver是否能够验证成功
 
 * Case 3: 在Case2的基础上，ZSK A和ZSK B的有效时间参数相同（比如1个小时），擦偶偶step4 测试，观察结果
 
 * Case 4: 改变ZSK A和ZSK B的有效时间参数（比如1个小时和1个半小时），将Case 3重做一遍 
 	* 轮转期间可能有好几种可能：A,B同时轮转，A轮转B不轮转，AB都不轮转
 	
注：Case4中会比较复杂，可以最后做，或者要求所有DM采用同样的参数。

### 测试结果分析

测试有可能有一下几种结果：

 * 输出测试结果，根据数据分析结果的原因
 
 * 不需要任何软件改变，通过配置即可完成multi-zsk功能，输出配置方法和运营建议
 
 * 需要软件实现的改变，通过增加补丁完成

